<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.0.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Boomkim</title>


    <meta property="og:type" content="website">
<meta property="og:title" content="Boomkim">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Boomkim">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Boomkim" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;" target="_blank" rel="noopener">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-12-04T00:59:11.881Z">2019-12-04</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 123 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/12/04/hello-world/">Hello World</a>
            
        </h1>
        <div class="content">
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo server</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo generate</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-11-03T15:00:00.000Z">2019-11-04</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/AWS-Lambda-SQS/">AWS Lambda SQS</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    14 minutes read (About 2043 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/11/04/2019-11-04-lambda-with-sqs/">Lambda의 동시성에 대하여 - 1</a>
            
        </h1>
        <div class="content">
            <h2 id="Lambda가-진정한-cloud-native인걸까"><a href="#Lambda가-진정한-cloud-native인걸까" class="headerlink" title="Lambda가 진정한 cloud native인걸까!"></a>Lambda가 진정한 cloud native인걸까!</h2><p><a href="https://blog.rocketpunch.com/2017/07/02/2-million-pv-with-300-krw/" target="_blank" rel="noopener">300원에 200만뷰 소화하기</a>라는 포스팅을 읽은 적이 있습니다. </p>
<p>그리고<br><a href="http://awsblogskr.s3-ap-northeast-2.amazonaws.com/pdf/2016-03-your-10mil-users-onaws-naverd2sf.pdf" target="_blank" rel="noopener">AWS와 함께 천만 사용자 웹서비스 만들기</a>라는 슬라이드도 본 적이 있습니다. </p>
<p>저 슬라이드를 처음 봤던 때에는 Lambda에 대해서 많이 사용을 안해봐서 그런지 저 자료들만 보면 왠지 엄청난 트래픽을 아주 적은 비용으로 큰 문제 없이 수용할 수 있을 것만 같았습니다. 그러면서 언젠가 full-serverless 로 구성된 서비스를 한번 만들어 봐야겠다는 생각을 했었습니다. <del>생각만요.</del> </p>
<p>생각해보면 단순히 REST API에 대한 요청만 받아주는 서비스라면 API GATEWAY + Lambda 로만 구성하는게 충분히 메리트 있을것 같았습니다. 그러면 정말 진정한 의미에 Pay-as-you-go 를 구현하는 클라우드 네이티브를 구현해볼 수 있지 않을까요…?</p>
<h2 id="Lambda-Edge와의-만남"><a href="#Lambda-Edge와의-만남" class="headerlink" title="Lambda@Edge와의 만남"></a>Lambda@Edge와의 만남</h2><p>그러던 중 우연찮게 Lambda@Edge를 사용해야 하는 일이 생겼습니다. 특정 헤더를 추가하거나 제거하는 단순한 로직을 Cloudfront에 추가해야 하는데 Cloudfront 자체로는 그런 기능을 제공하지 않기 때문입니다. 개발자체는 간단했습니다. 그런데 막상 실 트래픽에 적용하려고 하니 Lambda@Edge의 동시성 제한이라는 항목이 눈에 들어왔습니다. </p>
<p><img src="/images/lambda-edge-limits.png" alt="그림1"></p>
<p>Lambda@Edge는 각 리전에서 1000번의 동시실행 한도를 갖는다고 나와있습니다. </p>
<p>이게 막상 딱 “1000번 동시실행 제한” 이라는 말만 들으면 ‘뭐야 1000밖에 안돼?’ 라는 생각이 듭니다. </p>
<p>그래서 결국 당시에 서비스 오픈 전에 급하게 Limit 증설 요청을 했던 기억이 납니다. 게다가 저 Limit은 증설을 원하는 Region을 정하고 사유를 말해야 합니다. 결국 그때 막 support 엔지니어랑 전화도 하고 그래서 겨우 Limit을 높여놓은 기억이 있습니다. </p>
<p><del>그때 사실 결국 트래픽이 많이 들어오진 않아서 저 Limit 내에서 처리가 되긴 했습니다.</del> 그런데 그 당시 트래픽을 아주 일부 (약 1%?) 가량만 태운거라서 만약에 전체 트래픽을 부었으면 무조건 장애가 발생하는 상황이 났을겁니다. 1%만 부었는데도 peak로 발생했던 동시성이 한 300정도는 되었으니까 단순히 10배의 트래픽이 온다고 가정해도 limit 1000은 훌쩍 넘어가겠죠. </p>
<h2 id="Limit-1000이-적은걸까-많은걸까"><a href="#Limit-1000이-적은걸까-많은걸까" class="headerlink" title="Limit 1000이 적은걸까 많은걸까?"></a>Limit 1000이 적은걸까 많은걸까?</h2><p>‘Limit 1000’ 이라는 게 사실 작은 수치는 아닙니다. 왜냐하면 이건 단위가 tps같은게 아니라 말 그대로 ‘동시 실행 수’이기 때문이죠. 굳이 풀어서 설명하자면 ‘어느 한 순간에도 Lambda 함수가 동시에 1000개 이상 실행될 수는 없다’ 는 말입니다. 이걸 다시 풀어서 얘기하면, 좀 말도 안되는 가정이긴 합니다만 약 100ms 이내에 끝나는 로직이 완전 동기적으로 1000개가 동시에 실행되고 끝난다고 한다면 이 함수의 tps?는 단순 계산으론 1만 tps 이상이 됩니다. </p>
<p>그렇지만 이게 Limit이기 때문에 또 엄청 넉넉한 수치는 아닙니다. 특히 CDN은 보통 대량 트래픽을 가정하기 때문에 1초에 1만정도 처리한다고 가정해도 어떻게 보면 턱없이 모자란 수치일 수도 있는거죠. 그래서 저는 Lambda@Edge가 참 애매한 서비스라고 생각을 합니다. </p>
<p>물론 모든 로직을 Origin Response, Origin Request 등으로 몰아서 최대한 캐싱이 되게끔 만들면 대규모 트래픽에도 대응이 가능할 것 같긴한데, 그럴거면 그냥 원본서버 건드리는게 더 빠르지 않을까요? </p>
<p>CDN 자체의 성능을 훼손하지 않으면서 캐시와 사용자 사이의 logic을 컨트롤 할수 있어야 진정한 Lambda@Edge가 가능한 것 같고 그러려면 Viewer 단의 Lambda 동시성이 CDN이 제공하는 대역폭과 동시성 만큼을 커버해 줘야 할텐데 지금 제공하는 1000으로는 엄청 부족하죠. 즉, viewer 단의 Lambda를 적용해서 뭔가 이득을 보기엔 조금 애매해 보입니다. </p>
<p>물론 이 동시성을 늘려주긴 합니다. 그런데 보니깐 이 Limit을 늘려주는 데에도 꽤 많은 시간이 소요되더라구요. ELB Prewarming 처럼 바로바로 되는건 아닌 것 같았어요. (물론 ELB 프리워밍도 미리미리 해두어야 합니다.)</p>
<p>같은 맥락에서 일반적인 서비스의 was 대신에 이 Lambda를 이용하기에도 좀 애매한 수치가 됩니다. </p>
<p>즉, 저는 이 Limit 1000 이라는 수치가 애매한 수치로 보입니다. 트랜잭션이나 비지니스 로직이 복잡하고 많이 일어나는 어플리케이션에서는 이 수치가 매우 부족할수도 있을것 같네요. 그리고 유저 수가 동접 1만 명이 훌쩍 넘는다면 1000으론 어림도 없을 것 같습니다.</p>
<p>그런데 그냥 동접 1만명이 안되는 서비스 라면, 이 Limit 때문에 Lambda 도입을 망설이지는 않았음 좋겠습니다. 오히려 작은 규모의 서비스에 Lambda를 적용했을 때 비용적인 측면에서 효과가 엄청날거라고 생각하거든요. </p>
<h2 id="갑자기-결론"><a href="#갑자기-결론" class="headerlink" title="갑자기 결론?"></a>갑자기 결론?</h2><p>결국, ‘Lambda가 정말 좋긴한데 이 <strong>동시 실행 수 제한</strong>이라는 걸 서비스 구축시에 고려해야 한다’는 글이 이렇게 길어 졌네요. </p>
<p>기왕 길어진 김에 사설을 덧붙이자면, 천만 사용자를 가정한 서비스의 모든 백엔드를 Lambda로 구축할 수 는 없을 것 같습니다. 그런데 한 1만? 정도 까지는 충분히 Lambda만으로도 백엔드를 구축할수 있지 않을까 생각해봅니다. S3, API Gateway, Lambda, DynamoDB 만으로 이루어진 1만 사용자 어플리케이션… 한번 만들어 보고 싶네요. </p>
<h2 id="다음-글에선…"><a href="#다음-글에선…" class="headerlink" title="다음 글에선…"></a>다음 글에선…</h2><p>이번 글은 사실 ‘Lambda의 동시성을 컨트롤 하는 방법’의 서론을 쓰다가 길어져 버린 글입니다. 다음 글에서는 진짜 Lambda의 동시성을 컨트롤 하는 법에 대해서 한번 써볼 생각입니다. </p>
<h3 id="여담…"><a href="#여담…" class="headerlink" title="여담…"></a>여담…</h3><p>좀 이상한 방향으로 글이 흘러갔다는걸 느끼면서도 오늘은 일단 글을 오랜만에 쓴다는 것과 그 글을 마무리하는 데에 가장 큰 목적이 있기에 이렇게 중구난방한 글을 적습니다. </p>
<p>저는 책을 읽을 때 서론 읽는게 제일 재밌던데 쓸 때도 마찬가지로 서론 쓸 때가 제일 재밌는것 같아요. 기슬 블로그를 쓸 때는 유용하려면 막 자료도 들어가야 되고 검증된 코드도 들어가야되고 하잖아요. 근데 오늘 쓴 서론?처럼 약간 전체 글에대한 소개이면서도 그 주제에 대한 저의 정리이기도 한 글이 쓸 때 재밌는 것 같네요. </p>
<p>무슨 코드 한 줄 없이 기술블로그를 쓰나 싶지만서도 오히려 이런 글들이 있는 블로그도 나름 재미있지 않으려나요. 방법이나 실제 practice는 없고 의견만 있는 이런 글이 실질적인 도움이 되지는 않겠지만, ‘아 이 사람은 이런 기술에 대해서 이렇게 생각하는구나’는 걸 보는 것도 필요하지 않을까 싶네요.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-06-28T15:00:00.000Z">2019-06-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Bigdata-AWS-EMR/">Bigdata AWS EMR</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    15 minutes read (About 2175 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/06/29/2019-06-29-EMR-Athena-Zepplin/">EMR 에 올라간 Zeppelin 활용하여 Athena 이용하기. </a>
            
        </h1>
        <div class="content">
            <h2 id="들어가기-전에…"><a href="#들어가기-전에…" class="headerlink" title="들어가기 전에…"></a>들어가기 전에…</h2><p>최근에 AWS Datascience 소그룹 모임의 자료를 쭉 보던 중 아주 정리가 잘 되어있는 자료를 보았습니다. <a href="https://github.com/awskrug/datascience-group/tree/master/workshop-sustainable_data_analysis" target="_blank" rel="noopener">AWS 기반 지속 가능한 데이터 분석하기
</a> 라는 자료인데 <a href="https://www.bigdatahub.co.kr/index.do" target="_blank" rel="noopener">SK 빅데이터 허브</a>에서 제공하는 배달 업종 통화 기록을 베이스로 spark로 데이터를 변환하고 athena, Presto, tableau 를 이용해서 시각화 하는 내용을 담고 있습니다. ETL 부터 시각화까지의 내용을 아주 재밌는 데이터와 함께 잘 정리한 글입니다. (AWS 데이터사이언스 모임은 가보지 않았지만 언젠간 한번 꼭 참석하리라 마음을 먹은지 벌써 몇달째… )</p>
<p>한편, 위의 글에서는 Zeppelin을 Spark의 노트북으로써만 한정해서 사용하는게 조금 아쉬웠달까요. 물론 Tableau라는 훌륭한 시각화 툴을 언급했으므로 굳이 Zeppelin과 Athena를 엮을 필요는 없지만, <a href="https://boomkim.github.io/aws/athena/zeppelin/2019/05/24/athena-with-zeppelin.html" target="_blank" rel="noopener">전에 글</a>에서도 말했지만 s3+athena의 활용성을 높이기에 Zeppelin 만한 것도 없는것 같습니다. </p>
<p>특히, 위의 글에서 처럼 Spark을 EMR로 관리하고 그 노트북으로써 Zeppelin을 활용하는 환경이라면, Athena에도  접근이 가능하게 하는 것도 활용성을 높여줄 것 같습니다. <strong>EMR이 제공하는 Zeppelin 만으로 ETL, 분석을 쉽게할 수 있도록 노트북 환경을 만들고 여차하면 시각화까지 해결하는거죠.</strong> (물론 Zeppelin의 시각화에는 한계가 있습니다. Zeppelin은 노트북일 뿐 BI툴이 아니니까요) </p>
<p><del>(이 문단은 안읽으셔도 됩니다. EMR, Zeppelin의 애매한 관계에 대한 넉두리입니다.)</del><br>사실, Zeppelin을 이런 식으로 꽤나 중요하게 사용하고 싶다면 굳이 EMR에서 제공하는 Zeppelin을 이용하지 않아도 됩니다. EMR은 비싸니까요. EC2위에 직접 Zeppelin을 설치하고 따로 관리를 하는 편이 나을 수도 있습니다. EMR은 사실 항시 유지하는 클러스터를 위한 솔루션이 아닙니다. 반면에 Zeppelin을 멀티유저 환경에서 사용하면 항상 띄어놓는게 맞겠죠. 그래도 24X7 유지하는 클러스터를 위해서 EMR을 사용한다면 Multi-Master 기능을 고려할텐데 심지어 Multi-Master모드로 EMR을 올린다면 Zeppelin을 같이 사용할 수 없습니다. 그러니 조합이 꽤 애매합니다. 이것저것 고려하니 복잡해졌네요. 그냥 AWS에서 EMR 프로비저닝 할때 Athena와의 연계를 미리 고려해서 Zeppelin에 Interpreter 하나만 추가해놔주면 고민이 쉽게 해결될텐데… </p>
<p>이유야 어떻든 간에, 이 글의 목표는 <strong>EMR에 올려진 Zeppelin에 Athena를 연결</strong>시키는 겁니다. EC2에 Zeppelin이 올라가 있다고 해도 크게 달라지진 않을 것 같습니다. <strong>Role을 이용한 권한 연결</strong>이 핵심이니까요. 서론이 길었습니다. 얼른 본론으로 갑시다. </p>
<hr>
<h2 id="EMR의-Zeppelin에-Athena-Interpreter-추가하기"><a href="#EMR의-Zeppelin에-Athena-Interpreter-추가하기" class="headerlink" title="EMR의 Zeppelin에 Athena Interpreter 추가하기"></a>EMR의 Zeppelin에 Athena Interpreter 추가하기</h2><p><em>이번 글에서는 EMR에 Spark와 Zeppelin이 올라가 있다고 가정합니다.</em> </p>
<p>EMR에서 제공하는 Zeppelin에 Athena를 연결하려면 크게는 다음과 같은 작업을 해야합니다. </p>
<ul>
<li>IAM Role 수정 </li>
<li>Zeppelin에 JDBC Interpreter 설치 </li>
<li>Athena 용 JDBC 다운로드 </li>
<li>Athena에 맞게 JDBC Interpreter 추가</li>
</ul>
<p>그럼 하나씩 살펴보겠습니다. </p>
<h3 id="1-IAM-Role-수정"><a href="#1-IAM-Role-수정" class="headerlink" title="1. IAM Role 수정"></a>1. IAM Role 수정</h3><p>EMR의 Master에는 기본적으로 DynamoDB, Glue, Kinesis, RDS, S3, SNS, SQS 등에 관한 권한이 설정되어 있습니다. (아래 그림 참고)</p>
<p><img src="/images/EMR-EC2-Role.png" alt="그림1"></p>
<p>그런데 이번에는 Athena와 연동을 시켜줄 것이기 때문에, Athena를 컨트롤할 수 있는 권한을 추가해줘야합니다.<br>뭔가 Default는 건들면 안될 것 같으니 다음과 같이  새로 IAM Role을 추가합니다. </p>
<ul>
<li>Role -&gt; Create Role 클릭</li>
<li>이 역할을 사용할 서비스에서 EC2 선택후 [Next: Permissions] 클릭 </li>
<li>‘AmazonElasticMapReduceforEC2Role’ 와 ‘AmazonAthenaFullAccess’ 를 찾아 선택</li>
<li>태그는 무시 (원한다면 당연히 입력하셔도 됩니다.)</li>
<li>Role 이름에 ‘EMR_EC2_AthenaRole’ 입력 후 [Create Role] 클릭 </li>
</ul>
<p>이제 Role이 완성되었으니 이를 원래 있던 Role대신 넣어줘야 합니다. Zeppelin은 EMR의 마스터 노드에 있으니 Master노드를 찾아 변경해 Role을 변경해줍니다. </p>
<ul>
<li>EMR -&gt; 해당 Cluster 클릭 -&gt; Hardware -&gt; Master 의 ID 클릭 -&gt; EC2 Instance ID 클릭 (EC2 콘솔로 이동하게 됩니다)</li>
<li>EC2 콘솔에서 Actions -&gt; Instance Settings -&gt; Attach/Replace IAM Role 클릭 </li>
<li>IAM role 에서 ‘EMR_EC2_AthenaRole’ 선택 후 [Apply] 클릭 </li>
</ul>
<p>자, 이제 EMR의 마스터노드에서는 Athena를 마음껏 컨트롤할 수 있게 되었습니다. </p>
<p>그럼 이제 Zeppelin을 세팅해 봅시다.</p>
<h3 id="2-Zeppelin에-JDBC-Interpreter-설치"><a href="#2-Zeppelin에-JDBC-Interpreter-설치" class="headerlink" title="2. Zeppelin에 JDBC Interpreter 설치"></a>2. Zeppelin에 JDBC Interpreter 설치</h3><p>이상하게 EMR의 Zeppelin에는 JDBC Interpreter가 설치되어 있지 않습니다. 일단 Spark 만 컨트롤할 수 있게 가볍게 세팅이 되어 있는것 같네요. 그러니 우선 JDBC Interpreter를 설치해 줍시다. </p>
<p>일단, 마스터 노드에 ssh 로 접근해줍니다. (Windows는 putty 등 사용)</p>
 <figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ssh -i &#123;나의pemkey.pem&#125; hadoop@&#123;Masternode EC2  Public DNS&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">`</span></pre></td></tr></table></figure>

<p>그 다음엔 일단 Zeppelin을 멈추고, </p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sudo stop zeppelin</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">``` </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">jdbc interpreter를 설치하고,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">```bash</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sudo /usr/lib/zeppelin/bin/install-interpreter.sh -n jdbc</span></pre></td></tr></table></figure>

<p>Zeppelin을 다시 시작해줍니다. </p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sudo start zeppelin</span></pre></td></tr></table></figure>

<p><del><em>참 쉽죠?</em></del></p>
<h3 id="3-Athena-용-JDBC-다운로드"><a href="#3-Athena-용-JDBC-다운로드" class="headerlink" title="3. Athena 용 JDBC 다운로드"></a>3. Athena 용 JDBC 다운로드</h3><p>그럼 이제 Zeppelin이 사용할 Athena용 JDBC 드라이버를 받아봅시다. </p>
<p>우선 jar 파일이 들어갈 경로를 정해봅시다. 저는 <code>/usr/local/jar</code> 로 정했습니다. </p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/<span class="hljs-built_in">local</span>/jar</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sudo <span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/jar</span></pre></td></tr></table></figure>

<p>wget을 이용해서 jdbc 파일을 받고, </p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sudo wget https://s3.amazonaws.com/athena-downloads/drivers/JDBC/SimbaAthenaJDBC_2.0.7/AthenaJDBC42_2.0.7.jar</span></pre></td></tr></table></figure>
<p>마지막으로, zeppelin이 실행시킬 수 있게 권한을 바꿔줍니다.</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sudo chmod 755 AthenaJDBC42_2.0.7.jar</span></pre></td></tr></table></figure>

<h3 id="4-Athena에-맞게-JDBC-Interpreter-추가"><a href="#4-Athena에-맞게-JDBC-Interpreter-추가" class="headerlink" title="4. Athena에 맞게 JDBC Interpreter 추가"></a>4. Athena에 맞게 JDBC Interpreter 추가</h3><p>자, 이제 마지막입니다. JDBC Interpreter만 Athena에 맞게 세팅해서 구성해주면 끝납니다. </p>
<p>우측상단에 있는 Interpreter를 클릭후 Interpreter 창에서 Create를 누릅니다. </p>
<p><img src="/images/zeppelin-interpreter.png" alt="그림2"></p>
<p>그 후 다음과 같이 세팅합니다.</p>
<ul>
<li><code>Interpreter Name</code> 은 적당히 ‘athena’ 로 정해주고 </li>
<li><code>Interpreter Group</code> 은 JDBC 를 선택합니다. </li>
</ul>
<p>Properties 에서 </p>
<ul>
<li><code>default.password</code>, <code>default.user</code>는 빈칸으로</li>
<li><code>default.driver</code>는 <code>com.simba.athena.jdbc.Driver</code></li>
<li><code>default.url</code>은 다음과 같이 세팅합니다. <ul>
<li><code>jdbc:awsathena://athena.ap-northeast-2.amazonaws.com:443;S3OutputLocation=s3://aws-athena-query-results-{계정번호12자리}-ap-northeast-2;Schema=default;AwsCredentialsProviderClass=com.simba.athena.amazonaws.auth.InstanceProfileCredentialsProvider;</code> (서울리전 기준, 나머지 리전의 경우 리전에 맞춰서 세팅해주면 됩니다.)</li>
</ul>
</li>
</ul>
<p>Artifact는 jar파일을 받은 경로를 입력하면 됩니다. </p>
<p><code>/usr/local/jar/AthenaJDBC42_2.0.7.jar</code></p>
<p><img src="/images/zeppelin-interpreter-properties.png" alt="그림2.5"><br>[properties 예시]</p>
<p><em>Save를 누르면 드디어! Athena를 사용할 Interpreter가 생성이 됩니다.</em></p>
<hr>
<h2 id="테스트"><a href="#테스트" class="headerlink" title="테스트"></a>테스트</h2><p>그럼 Athena랑 연결이 잘 되었는지 테스트해 봅시다. </p>
<p>Notebook-&gt; Create New Note 에서 Default Interpreter를 Athena 로 선택 후 생성합니다. </p>
<p><img src="/images/zeppelin-create-notebook.png" alt="그림3"></p>
<p>athena에 등록된 테이블에 쿼리를 날려봤습니다. </p>
<p><img src="/images/emr-zeppelin-athena-final-example.png" alt="그림4"></p>
<p>잘 되네요. <del>(꼭 얄밉게 잘된것만 보여주는 나쁜 사람들이 있습니다.)</del></p>
<hr>
<h2 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h2><p>지금까지 EMR에서 설치해주는 Zeppelin에 Athena를 얹어봤습니다. 이를 통해서 </p>
<ul>
<li>Spark로 ETL해서 S3로 넣고 </li>
<li>Athena로 분석</li>
<li>부족하지만 시각화 </li>
</ul>
<p>까지 Zeppelin이라는 하나의 노트북을 환경 통해 좀 편하게 할 수 있지 않을까 해서 포스팅을 써봤습니다. </p>
<p>BI를 고려한다면 Zeppelin 안써도 됩니다. BI툴 쓰세요 ㅎㅎㅎ. 그리고 Athena 안쓰고 Spark 내에서 다 ETL, 분석 까지 가능하다면 굳이 Athena와 연결하는데 에너지 쓸 이유는 없습니다. </p>
<p>다만, BigQuery를 필두로 한 SQL을 통한 분석이 요새 대세인것 같기도 하고 실제로 데이터분석가들이 SQL을 많이 사용하는것 같기도 해서 Athena의 사용성이 좋아지길 기대하고 있습니다. 또 Athena와의 연동이 보시다시피 그렇게 어렵지는 않잖아요? </p>
<p>한편으로는 오픈소스 Zeppelin이 더 잘되길 바라는 마음도 있습니다. Zeppelin 화이팅! </p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-06-06T15:00:00.000Z">2019-06-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/AWS-Elasticsearch/">AWS Elasticsearch</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 461 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/06/07/2019-06-20-amazon-elasticsearch-dedicated-master-free-storage/">Amazon Elasticsearch Dedicated Master의 스토리지 비용은?</a>
            
        </h1>
        <div class="content">
            <h1 id="Amazon-Elasticsearch-Dedicated-Master의-스토리지-비용은"><a href="#Amazon-Elasticsearch-Dedicated-Master의-스토리지-비용은" class="headerlink" title="Amazon Elasticsearch Dedicated Master의 스토리지 비용은?"></a>Amazon Elasticsearch Dedicated Master의 스토리지 비용은?</h1><p>Amazon Elasticsearch 에는 Dedicated Master를 설정해줄 수 있습니다. 마스터노드의 기능만 하는 노드를 따로 빼서 클러스터의 안정성을 높이는 방안입니다. Elastic의 문서에도 클러스터의 사이즈가 큰 경우 마스터 노드를 분리하는 것을 권장하고 있네요. (참고: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html</a>)</p>
<p>오늘 내용은 Dedicated Master에 대한 디테일한 내용이 아니라 비용에 관한 간단한 얘기입니다. </p>
<p>결론부터 말씀드리면 <strong>Dedicated Master는 노드당 비용만 받고 스토리지 비용은 과금되지 않습니다.</strong></p>
<p>Amazon Elasticsearch를 Production 타입으로 만들면 아래 그림처럼 Data Instances, Dedicated master instances, Storage 등을 선택할 수 있습니다. </p>
<p><img src="/images/elasticsearch-master-freestorage.png" alt="screenshot01"></p>
<p>그런데 이 Storage 설정 부분은 Data node에만 적용이 됩니다. 여기에서 설정한 <code>Storage 양 X 데이터 노드의 수</code>가 클러스터의 총 용량이 되는거죠. </p>
<p>그럼 Dedicated master instance 에는? Storage 관련해서 설정해주는 부분이 눈씻고 찾아봐도 없습니다.<br>그래서 aws에 support case를 열어 물어보았더니 아래와 같은 답변이 왔습니다. </p>
<blockquote>
<p>I would like to mention that Storage settings do not apply to any dedicated master nodes in the cluster.<br>Hence, the pricing for dedicated master instances would be based on their instance type and not for the storage.</p>
</blockquote>
<p>즉, Dedicated master instance는 그냥 instance 요금만 받는다는 겁니다. 하긴 Dedicated master instance 만해도 기본 인스턴스를 3개씩 써야되는데 스토리지 조금정도는 서비스해줄 수 있겠네요. </p>
<p>별로 중요한 정보는 아니지만, aws 문서에 잘 나와있지 않아서 한번 포스팅해봅니다. </p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-06-06T15:00:00.000Z">2019-06-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/AWS-Athena-Cloudfront/">AWS Athena Cloudfront</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 minutes read (About 1286 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/06/07/2019-06-07-athena-cf-log-analysis/">AWS Athena, CF Log 분석을 위한 쿼리 예시</a>
            
        </h1>
        <div class="content">
            <h1 id="AWS-Athena-Cloudfront-Log-분석을-위한-쿼리-예시"><a href="#AWS-Athena-Cloudfront-Log-분석을-위한-쿼리-예시" class="headerlink" title="AWS Athena, Cloudfront Log 분석을 위한 쿼리 예시"></a>AWS Athena, Cloudfront Log 분석을 위한 쿼리 예시</h1><p>Cloudfront는 고맙게도 Edge단에서 발생하는 처리 로그들을 모아서 제공해 줍니다. CF Log는 기본적으로 S3에 gz 형태로 압축되엇 제공이 되고<br>다음과 같은 DDL을 통해 테이블을 정의하면 Athena에서 조회할 수 있습니다. </p>
<figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTERNAL</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> default.cloudfront_logs (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="hljs-string">`date`</span> <span class="hljs-built_in">DATE</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="hljs-built_in">time</span> <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  location <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  <span class="hljs-keyword">bytes</span> <span class="hljs-built_in">BIGINT</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  request_ip <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  method <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  host <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  uri <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">  <span class="hljs-keyword">status</span> <span class="hljs-built_in">INT</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  referrer <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  user_agent <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">  query_string <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  cookie <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">  result_type <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  request_id <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">  host_header <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">  request_protocol <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">  request_bytes <span class="hljs-built_in">BIGINT</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">  time_taken <span class="hljs-built_in">FLOAT</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">  xforwarded_for <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">  ssl_protocol <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">  ssl_cipher <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">  response_result_type <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">  http_version <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">  fle_status <span class="hljs-keyword">STRING</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">  fle_encrypted_fields <span class="hljs-built_in">INT</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ROW</span> <span class="hljs-keyword">FORMAT</span> <span class="hljs-keyword">DELIMITED</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FIELDS</span> <span class="hljs-keyword">TERMINATED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">'\t'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">LOCATION <span class="hljs-string">'s3://CloudFront_bucket_name/AWSLogs/ACCOUNT_ID/'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">TBLPROPERTIES ( <span class="hljs-string">'skip.header.line.count'</span>=<span class="hljs-string">'2'</span> )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">``</span><span class="hljs-string">` </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">출처: https://docs.aws.amazon.com/ko_kr/athena/latest/ug/cloudfront-logs.html</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">위의 쿼리문에서 다른것은 수정할 것 없이 `</span>LOCATION<span class="hljs-string">` 뒤의 s3 버킷 주소만 자신의 버킷에 맞게 수정해주면 됩니다. </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">이렇게 테이블 정의를 하고 나면 필요에 따라 쿼리를 날려 CF로그를 분석 할 수 있습니다. CF Cache Statistics 등에서도 통계를 제공해주기 때문에 통계에 관한 쿼리가 별로 필요하지 않을 수도 있지만, 따로 대시보드를 구성해 시각화 툴과 연계한다던가 할때는 필요할만한 것들을 모아봤습니다. Troubleshooting이 필요할 때는 그때그때 상황에 맞게 쿼리를 해야해서 예시를 들기가 어렵네요. 아래 예시 쿼리들은 참고만 하시고 필요에 맞게 변경해서 사용하시기 바랍니다. </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"># 쿼리 예시 </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">## 일별 사용량 (GB)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">`</span><span class="hljs-string">``</span><span class="hljs-keyword">SQL</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-built_in">date</span>, <span class="hljs-keyword">sum</span>(<span class="hljs-keyword">bytes</span>)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span> <span class="hljs-keyword">as</span> GB  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-string">"sample_db"</span>.<span class="hljs-string">"cloudfront_logs"</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-built_in">date</span>;</span></pre></td></tr></table></figure>

<h2 id="CloudFront-응답-별-카운트"><a href="#CloudFront-응답-별-카운트" class="headerlink" title="CloudFront 응답 별 카운트"></a>CloudFront 응답 별 카운트</h2><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	response_result_type, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">as</span> cnt </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-string">"sample_db"</span>.<span class="hljs-string">"cloudfront_logs"</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">	response_result_type</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">	cnt <span class="hljs-keyword">DESC</span>;</span></pre></td></tr></table></figure>

<h2 id="에러의-응답-코드-별-조회"><a href="#에러의-응답-코드-별-조회" class="headerlink" title="에러의 응답 코드 별 조회"></a>에러의 응답 코드 별 조회</h2><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-keyword">status</span>, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">as</span> cnt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-string">"sample_db"</span>.<span class="hljs-string">"cloudfront_logs"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">WHERE</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">	result_type = <span class="hljs-string">'Error'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-keyword">status</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">	cnt <span class="hljs-keyword">DESC</span>;</span></pre></td></tr></table></figure>

<h2 id="상위-20개-에러-4XX-5XX-uri"><a href="#상위-20개-에러-4XX-5XX-uri" class="headerlink" title="상위 20개 에러(4XX,5XX) uri"></a>상위 20개 에러(4XX,5XX) uri</h2><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	uri, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">as</span> cnt </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-string">"sample_db"</span>.<span class="hljs-string">"cloudfront_logs"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">WHERE</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">	result_type = <span class="hljs-string">'Error'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">	uri</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">	cnt <span class="hljs-keyword">DESC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">limit</span> <span class="hljs-number">20</span>;</span></pre></td></tr></table></figure>

<h2 id="상위-20개-요청ip-count"><a href="#상위-20개-요청ip-count" class="headerlink" title="상위 20개 요청ip count"></a>상위 20개 요청ip count</h2><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	request_ip, <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> cnt </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	cloudfront_logs</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">	request_ip</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">	cnt <span class="hljs-keyword">DESC</span>;</span></pre></td></tr></table></figure>

<h2 id="상위-20-Referrer-Count"><a href="#상위-20-Referrer-Count" class="headerlink" title="상위 20 Referrer Count"></a>상위 20 Referrer Count</h2><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	referrer, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">as</span> cnt </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-string">"sample_db"</span>.<span class="hljs-string">"cloudfront_logs"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">	referrer</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">	cnt <span class="hljs-keyword">DESC</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">20</span>;</span></pre></td></tr></table></figure>


<h1 id="시계열-분석-예시"><a href="#시계열-분석-예시" class="headerlink" title="시계열 분석 예시"></a>시계열 분석 예시</h1><p>시계열 분석을 위해서는 기본 테이블에 저장된 date, time의 데이터를 concat(), from_iso8601_timestamp(), date_trunc() 등을 이용해 변환해주어야 합니다.<br>Athena는 Select 절에서 Alias가 잘 만들어지지 않아서 cte를 쓰는 편이 편합니다. </p>
<h2 id="CTE-예시"><a href="#CTE-예시" class="headerlink" title="CTE 예시"></a>CTE 예시</h2><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">WITH</span> cte <span class="hljs-keyword">AS</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-keyword">SELECT</span> from_iso8601_timestamp(<span class="hljs-keyword">concat</span>(<span class="hljs-keyword">concat</span>(<span class="hljs-keyword">date_format</span>(<span class="hljs-built_in">date</span>, <span class="hljs-string">'%Y-%m-%d'</span>), <span class="hljs-string">'T'</span>), <span class="hljs-built_in">time</span>)) <span class="hljs-keyword">AS</span> ts</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">FROM</span> <span class="hljs-string">"sample_db"</span>.<span class="hljs-string">"cloudfront_logs"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">)</span></pre></td></tr></table></figure>

<h2 id="5월-29일-UTC-기준-시간별-요청수-오름차순"><a href="#5월-29일-UTC-기준-시간별-요청수-오름차순" class="headerlink" title="5월 29일(UTC 기준) 시간별 요청수, 오름차순"></a>5월 29일(UTC 기준) 시간별 요청수, 오름차순</h2><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">WITH</span> cte <span class="hljs-keyword">AS</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	<span class="hljs-keyword">SELECT</span> from_iso8601_timestamp(<span class="hljs-keyword">concat</span>(<span class="hljs-keyword">concat</span>(<span class="hljs-keyword">date_format</span>(<span class="hljs-built_in">date</span>, <span class="hljs-string">'%Y-%m-%d'</span>), <span class="hljs-string">'T'</span>), <span class="hljs-built_in">time</span>)) <span class="hljs-keyword">AS</span> ts</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">FROM</span> <span class="hljs-string">"sample_db"</span>.<span class="hljs-string">"cloudfront_logs"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">)<span class="hljs-keyword">SELECT</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">	date_trunc(<span class="hljs-string">'hour'</span>,ts) <span class="hljs-keyword">as</span> <span class="hljs-built_in">TIME</span>, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">as</span> CNT</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> cte</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">WHERE</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">	ts &gt;= from_iso8601_timestamp(<span class="hljs-string">'2019-05-29T00:00:00'</span>) <span class="hljs-keyword">AND</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">	ts &lt; from_iso8601_timestamp(<span class="hljs-string">'2019-05-30T00:00:00'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">	date_trunc(<span class="hljs-string">'hour'</span>,ts)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">	date_trunc(<span class="hljs-string">'hour'</span>,ts);</span></pre></td></tr></table></figure>

<h2 id="5월-29일-UTC-기준-시간별-전송량-Gb"><a href="#5월-29일-UTC-기준-시간별-전송량-Gb" class="headerlink" title="5월 29일(UTC 기준) 시간별 전송량(Gb)"></a>5월 29일(UTC 기준) 시간별 전송량(Gb)</h2><pre><code class="SQL"><span class="keyword">WITH</span> cte <span class="keyword">AS</span> (
    <span class="keyword">SELECT</span> from_iso8601_timestamp(<span class="keyword">concat</span>(<span class="keyword">concat</span>(<span class="keyword">date_format</span>(<span class="built_in">date</span>, <span class="string">'%Y-%m-%d'</span>), <span class="string">'T'</span>), <span class="built_in">time</span>)), <span class="keyword">bytes</span> <span class="keyword">AS</span> ts
    <span class="keyword">FROM</span> <span class="string">"sample_db"</span>.<span class="string">"cloudfront_logs"</span>
)<span class="keyword">SELECT</span> 
    date_trunc(<span class="string">'hour'</span>,ts) <span class="keyword">as</span> <span class="built_in">TIME</span>, <span class="keyword">sum</span>(<span class="keyword">bytes</span>)/<span class="number">1024</span>/<span class="number">1024</span>/<span class="number">1024</span> <span class="keyword">as</span> Gb
<span class="keyword">FROM</span> cte
<span class="keyword">WHERE</span> 
    ts &gt;= from_iso8601_timestamp(<span class="string">'2019-05-29T00:00:00'</span>)<span class="keyword">AND</span> 
    ts &lt; from_iso8601_timestamp(<span class="string">'2019-05-30T00:00:00'</span>)
<span class="keyword">GROUP</span> <span class="keyword">BY</span> 
    date_trunc(<span class="string">'hour'</span>,ts)
<span class="keyword">ORDER</span> <span class="keyword">BY</span> 
    date_trunc(<span class="string">'hour'</span>,ts);</code></pre>
<h2 id="5월-29일-UTC-기준-시간별-에러수"><a href="#5월-29일-UTC-기준-시간별-에러수" class="headerlink" title="5월 29일(UTC 기준) 시간별 에러수"></a>5월 29일(UTC 기준) 시간별 에러수</h2><pre><code class="SQL"><span class="keyword">WITH</span> cte <span class="keyword">AS</span> (
    <span class="keyword">SELECT</span> from_iso8601_timestamp(<span class="keyword">concat</span>(<span class="keyword">concat</span>(<span class="keyword">date_format</span>(<span class="built_in">date</span>, <span class="string">'%Y-%m-%d'</span>), <span class="string">'T'</span>), <span class="built_in">time</span>)) <span class="keyword">AS</span> ts
    <span class="keyword">FROM</span> <span class="string">"sample_db"</span>.<span class="string">"cloudfront_logs"</span>
)<span class="keyword">SELECT</span> 
    date_trunc(<span class="string">'hour'</span>,ts) <span class="keyword">as</span> <span class="built_in">TIME</span>, <span class="keyword">count</span>(*) <span class="keyword">as</span> CNT
<span class="keyword">FROM</span> 
    cte
<span class="keyword">WHERE</span> 
    ts &gt;= from_iso8601_timestamp(<span class="string">'2019-05-29T00:00:00'</span>) <span class="keyword">AND</span> 
    ts &lt; from_iso8601_timestamp(<span class="string">'2019-05-30T00:00:00'</span>) <span class="keyword">AND</span> 
    result_type = <span class="string">'Error'</span>
<span class="keyword">GROUP</span> <span class="keyword">BY</span> 
    date_trunc(<span class="string">'hour'</span>,ts)
<span class="keyword">ORDER</span> <span class="keyword">BY</span> 
    date_trunc(<span class="string">'hour'</span>,ts);</code></pre>
<h2 id="시간별-평균-전송시간"><a href="#시간별-평균-전송시간" class="headerlink" title="시간별 평균 전송시간"></a>시간별 평균 전송시간</h2><pre><code class="SQL"><span class="keyword">WITH</span> cte <span class="keyword">AS</span> (
    <span class="keyword">SELECT</span> from_iso8601_timestamp(<span class="keyword">concat</span>(<span class="keyword">concat</span>(<span class="keyword">date_format</span>(<span class="built_in">date</span>, <span class="string">'%Y-%m-%d'</span>), <span class="string">'T'</span>), <span class="built_in">time</span>)) <span class="keyword">AS</span> ts, time_taken
    <span class="keyword">FROM</span> <span class="string">"sample_db"</span>.<span class="string">"cloudfront_logs"</span>
)<span class="keyword">SELECT</span> 
    date_trunc(<span class="string">'hour'</span>,ts) <span class="keyword">as</span> <span class="built_in">TIME</span>, <span class="keyword">avg</span>(time_taken) <span class="keyword">as</span> avg_time
<span class="keyword">FROM</span> cte
<span class="keyword">WHERE</span> 
    ts &gt;= from_iso8601_timestamp(<span class="string">'2018-05-29T00:00:00'</span>) <span class="keyword">AND</span> 
    ts &lt; from_iso8601_timestamp(<span class="string">'2019-05-30T00:00:00'</span>)
<span class="keyword">GROUP</span> <span class="keyword">BY</span> 
    date_trunc(<span class="string">'hour'</span>,ts)
<span class="keyword">ORDER</span> <span class="keyword">BY</span> 
    date_trunc(<span class="string">'hour'</span>,ts);</code></pre>
<h2 id="주의할-점"><a href="#주의할-점" class="headerlink" title="주의할 점"></a>주의할 점</h2><p>Athena는 스캔한 데이터의 양에 비례해서 과금이 됩니다. 그런데 Cloudfront Log는 보통 양이 상당히 많은데도 데이터가 파티셔닝되지 않고 하나의 버킷에 통째로 저장이 되죠. <b>결국 Cloudfront의 Log 양이 상당해지면 Athena가 스캔하는 데이터의 양도 늘어나고 그러면 성능도 느려지겠죠.</b></p>
<p>따라서 데이터의 양이 많아지는 경우, 파티셔닝을 고려해봐야 합니다. 여기 <a href="https://aws.amazon.com/ko/blogs/big-data/analyze-your-amazon-cloudfront-access-logs-at-scale/" target="_blank" rel="noopener">AWS 블로그</a>에서 Cloudfront로그를 파티셔닝하고, 파싱해서 더 많은 정보를 부여 (예를들어, bot인지 아닌지 여부를 판단해서 isBot이라는 column을 추가)하는 예제를 만들어 놓았네요. 따라해보진 않았지만 꽤 유용할것 같습니다. 글이 포스팅된지 꽤 된것 같은데 한국어로 번역된글도 없는걸 보니 한번 따라해보면서 번역글을 작성해도 괜찮겠네요. </p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-05-23T15:00:00.000Z">2019-05-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/AWS-Athena-Zeppelin/">AWS Athena Zeppelin</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    16 minutes read (About 2332 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/05/24/2019-05-24-athena-with-zeppelin/">AWS Athena, Zeppelin과 함께 사용하기 (feat. ALB 로그분석)</a>
            
        </h1>
        <div class="content">
            <h1 id="Athena-심플하고-강력하지만-아쉬운-인터페이스"><a href="#Athena-심플하고-강력하지만-아쉬운-인터페이스" class="headerlink" title="Athena, 심플하고 강력하지만 아쉬운 인터페이스"></a>Athena, 심플하고 강력하지만 아쉬운 인터페이스</h1><p>이번 포스팅에서는 Athena 와 Zeppelin을 엮어서 사용하는 방법에 대해서 정리하려고 합니다. Athena는 써보면 써볼수록 요물이라는 생각이 드는 제품입니다. S3에 데이터만 잘 저장해 놓으면 그걸 SQL문으로 빠르게 쿼리할 수 있다는 컨셉이 간단하지만 강력하네요. 다른 분산처리 플랫폼도 많지만, 일단 간단하게 시작하기에는 Athena가 최적인것 같아요. </p>
<p>다만, Athena가 워낙 심플한 구조를 갖고 있고 제공해주는 기능도 심플하다 보니 조금 아쉬운점도 있는데요, 일단 제 생각에 가장 아쉬운 점은 <code>인터페이스</code> 입니다. ‘대화형 쿼리’ 라는 컨셉으로 단순한 쿼리창만 갖고 있지만, 사실 ‘대화형’ 이라는 말처럼 채팅기록이 남진 않는게 제 생각엔 커다란 단점인 것 같아요. 우리나라 정서가 워낙 UI에 이것저것 많은 기능을 좋아해서 상대적으로 AWS의 UI가 좀 빈약하다는 느낌을 많이 받는데 Athena의 인터페이스도 그 중 하나인 것 같습니다. 그래도 ‘대화형’이라는 컨셉을 완성하기 위해서는 조금 더 인터페이스가 발전해야 할 것 같다고 생각합니다. </p>
<p>예를들어, 웹로그를 분석하는 과정에서 <em>이전 쿼리의 결과를 들고 있어야 하는 경우<em>가 있습니다. 다음과 같이 요청수 top 10의 정보를 받아왔다고 합시다. </em></em></p>
<pre><code>-- 요청수 top 10 client ip
select client_ip, count(*) as requests from &quot;logs&quot;.&quot;alb_logs_apache&quot;
group by client_ip
order by requests desc
limit 10;</code></pre><p>그리고 이제, 여기에 나온 client ip 각각에 대해 다음과 같은 쿼리를 통해 어떤 행동을 하는지 알아본다고 합시다. </p>
<pre><code>-- top 10 ip 각각에 대해 어떤 행동을 하고 있는지 조사 
select * from &quot;logs&quot;.&quot;alb_logs_apache&quot;
where client_ip=&apos;000.000.000.000&apos;</code></pre><p>이런 작업을 하려고 하면 athena에서는 쿼리창을 따로 만들어 놔야 합니다. 사실 쿼리 창을 따로 만들어 놓아도 결과가 잘 저장되지 않는 버그(?) 같은게 있습니다. </p>
<h2 id="Zeppelin으로-인터페이스를-보강"><a href="#Zeppelin으로-인터페이스를-보강" class="headerlink" title="Zeppelin으로 인터페이스를 보강"></a>Zeppelin으로 인터페이스를 보강</h2><p>이러한 단점을 단번에 해결해주는게 바로 <code>Zeppelin</code> 입니다. Zeppelin은 Jupyter 처럼 노트북 환경을 제공해주는 오픈소스 프로젝트입니다. Zeppelin에 대한 소개는 <a href="https://medium.com/apache-zeppelin-stories/%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4-%EC%9D%BC%EA%B8%B0-2-apache-zeppelin-%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-f3a520297938" target="_blank" rel="noopener">https://medium.com/apache-zeppelin-stories/%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4-%EC%9D%BC%EA%B8%B0-2-apache-zeppelin-%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-f3a520297938</a> 에 잘 정리되어 있네요. 짧게 설명을 드리면, Zeppelin은 Spark 작업을 편하게 하기 위해서 만들어 놓은 노트북이지만, 써보니 다른 분석 툴과도 같이 쓰이고 Athena 와도 매우 잘 맞는 노트북인 것 같습니다. </p>
<p><img src="/images/athenaXzeppelin-notebook.png" alt="그림0"><br>Zeppelin 화면 예시 </p>
<p>위에서 언급했지만 Athena에서 주창하는 ‘대화형 쿼리’의 컨셉을 결국 완성시키려면 ‘노트북 인터페이스’ 가 있어야 완성이 되는것 같아요. 쿼리문의 특성상, 그때 그때 궁금한 것을 쿼리로 날리려면 이전의 결과를 들고 있어야 하는 경우가 매우 많고, 또한 그 쿼리문의 결과를 시각화해서 볼 수 있으면 사용성이 정말 매우매우 좋아집니다. 만약 제가 아마존의 Product 팀에 있다면 Athena의 웹 인터페이스를 당장 노트북 인터페이스로 바꾸자고 하고 싶을 정도로,  <code>아 아테나의 완성은 이거다.</code> 싶었습니다. </p>
<h2 id="Zeppelin-설치"><a href="#Zeppelin-설치" class="headerlink" title="Zeppelin 설치"></a>Zeppelin 설치</h2><p>참고: <a href="https://b.luavis.kr/server/zeppelin-with-athena" target="_blank" rel="noopener">https://b.luavis.kr/server/zeppelin-with-athena</a></p>
<p>zeppelin과 athena를 연동하는 방법은 위의 포스팅에 아주 정리가 잘 되어 있습니다. </p>
<h2 id="Zeppelin-에서-ALB-로그-분석"><a href="#Zeppelin-에서-ALB-로그-분석" class="headerlink" title="Zeppelin 에서 ALB 로그 분석"></a>Zeppelin 에서 ALB 로그 분석</h2><p>Zeppelin의 설치는 위의 포스팅을 쭉 따라가서 성공하셨을거라고 믿습니다. 그럼 Athena X Zeppelin의 강점을 ALB의 로그를 이리저리 쿼리해 보면서 느껴(?)보도록 합시다. </p>
<p>ALB로그는 기본적으로 Apache 로그 포맷에 ALB에서 제공하는 컬럼이 추가된 형태입니다. (Lambda와의 연동 기능이 추가되면서 로그에 컬럼도 추가되었습니다.) 저는 간단하게 ALB에 apache 서버를 물려서 예제 사이트를 구축해놓았습니다. 트래픽은 굳이 일부러 만들진 않고 제 로컬에서만 몇번 들어가보았더니 많이 나오진 않았습니다. 결국 로그가 많이 나오진 않아서 굳이 Athena를 쓰지 않고 Excel 같은 툴로도 충분히 로그를 이리저리 뜯어 볼 수 있었으나, 일반적으로 ALB로그는 양이 많아서 Excel같은 걸로는 뜯어보기가 굉장히 어렵습니다. (버벅댑니다.) 그래서 Athena X Zeppelin을 통해서 간단하게 쿼리하고, 시각화까지 해보도록 하겠습니다. </p>
<p>기본적으로 ALB는 로그를 활성화하면 S3에 저장되고, Athena는 다음과 같은 DDL을 통해 ALB로그를 바라보는 테이블을 생성할 수 있습니다. </p>
<pre><code>CREATE EXTERNAL TABLE IF NOT EXISTS alb_logs (
            type string,
            time string,
            elb string,
            client_ip string,
            client_port int,
            target_ip string,
            target_port int,
            request_processing_time double,
            target_processing_time double,
            response_processing_time double,
            elb_status_code string,
            target_status_code string,
            received_bytes bigint,
            sent_bytes bigint,
            request_verb string,
            request_url string,
            request_proto string,
            user_agent string,
            ssl_cipher string,
            ssl_protocol string,
            target_group_arn string,
            trace_id string,
            domain_name string,
            chosen_cert_arn string,
            matched_rule_priority string,
            request_creation_time string,
            actions_executed string,
            redirect_url string,
            lambda_error_reason string,
            new_field string
            )
            ROW FORMAT SERDE &apos;org.apache.hadoop.hive.serde2.RegexSerDe&apos;
            WITH SERDEPROPERTIES (
            &apos;serialization.format&apos; = &apos;1&apos;,
            &apos;input.regex&apos; = 
        &apos;([^ ]*) ([^ ]*) ([^ ]*) ([^ ]*):([0-9]*) ([^ ]*)[:-]([0-9]*) ([-.0-9]*) ([-.0-9]*) ([-.0-9]*) (|[-0-9]*) (-|[-0-9]*) ([-0-9]*) ([-0-9]*) \&quot;([^ ]*) ([^ ]*) (- |[^ ]*)\&quot; \&quot;([^\&quot;]*)\&quot; ([A-Z0-9-]+) ([A-Za-z0-9.-]*) ([^ ]*) \&quot;([^\&quot;]*)\&quot; \&quot;([^\&quot;]*)\&quot; \&quot;([^\&quot;]*)\&quot; ([-.0-9]*) ([^ ]*) \&quot;([^\&quot;]*)\&quot; \&quot;([^\&quot;]*)\&quot;($| \&quot;[^ ]*\&quot;)(.*)&apos;)
            LOCATION &apos;s3://your-alb-logs-directory/AWSLogs/&lt;ACCOUNT-ID&gt;/elasticloadbalancing/&lt;REGION&gt;&apos;;</code></pre><p>파티션을 나눠주면 더 좋겠지만, 지금은 일단 데이터 양이 많지 않으므로 생략합니다. 일단 테이블을 만들었으니, 테이블이 어떻게 생겨먹었는지 확인해 봐야겠죠. </p>
<pre><code>-- 테이블 예시
select * from &quot;logs&quot;.&quot;alb_logs_apache&quot;
limit 10;</code></pre><p>네, ALB의 컬럼들은 이렇게 생겼습니다. 그럼, 제 가짜 사이트에 요청이 몇번이나 들어왔는지 확인해 볼까요? </p>
<pre><code>-- 전체 리퀘스트 수
select count(*) as requests from &quot;logs&quot;.&quot;alb_logs_apache&quot;;</code></pre><p>그럼, 어떤 분들이 들어왔는지 확인해보도록 하겠습니다. </p>
<pre><code>-- 요청수 top 10 client ip
select client_ip, count(*) as requests from &quot;logs&quot;.&quot;alb_logs_apache&quot;
group by client_ip
order by requests desc
limit 10;</code></pre><p>음… 제 가짜 사이트에 관심이 많은 이분들은 그럼 어떤 요청들을 날리는지 볼까요? </p>
<pre><code>-- 특정 Client_ip의 요청 URI 
SELECT request_url
FROM &quot;logs&quot;.&quot;alb_logs_apache&quot;
WHERE client_ip=&apos;000.000.000.000&apos;</code></pre><p>역시, 이상한 bot입니다. 워드프레스의 취약점을 노리는 봇들이 많다고 하는데 실체를 이렇게 확인하게 되네요. <br><br>그 외에도 응답을 잘 주고 있는지 봐야겠죠? </p>
<pre><code>-- 응답 코드 별 count 
select elb_status_code, count(*) from &quot;logs&quot;.&quot;alb_logs_apache&quot;
group by elb_status_code
order by count(*) desc;</code></pre><p>정상적인 사이트라면 200 응답이 많겠지만, 제 사이트에는 200응답 보다는 404 응답이 많네요. 여기서 진짜 좋은점은, Zeppelin에서 파이차트도 간단하게 만들 수 있다는 점입니다. 한눈에 쏙 들어오니 보기가 좋네요.<br><img src="/images/athenaXzeppelin-piechart.png" alt="그림1"></p>
<pre><code>-- target ip 별 count (로드밸런싱이 잘 되고 있는지. )
select target_ip, count(*) from &quot;logs&quot;.&quot;alb_logs_apache&quot;
group by target_ip;</code></pre><p>위처럼 로드밸런싱이 잘 되고 있는지 확인하는것도 간단해 보이지만 중요합니다. 실제로 로드밸런싱이 잘 안되고 있는 사례도 많고, 그런 경우 장애의 포인트가 되기도 때문입니다. </p>
<pre><code>-- 시계열 분석... 
select date_trunc(&apos;hour&apos;,from_iso8601_timestamp(time)) as TIME, count(*) as count
from &quot;logs&quot;.&quot;alb_logs_apache&quot;
group by TIME
order by TIME ASC;</code></pre><p>시계열 분석을 위해서는 위에 코드 처럼 먼저 String 타입으로 된 시간을 Date 타입으로 변경해주는 작업이 필요합니다. 또한 로그상에는 ms 단위까지 표현이 되지만 시간단위로 잘라줘야 집계가 편합니다. 위와 같이 쿼리하면 시간단위로 내 사이트엔 몇명이 오는지 파악할 수 있고, 제플린에서는 line chart로 바로 시각화가 가능합니다. </p>
<p>아래처럼 대시보드를 만들 수 도 있습니다. </p>
<p><img src="/images/athenaXzepplin-dashboard.png" alt="그림3"><br></p>
<h2 id="Athena-X-Zeppelin"><a href="#Athena-X-Zeppelin" class="headerlink" title="Athena X Zeppelin"></a>Athena X Zeppelin</h2><p>위의 예시처럼, Athena의 아쉬운 인터페이스를 Zeppelin을 통해 보완할 수 있습니다. 설치도 docker를 통해서 간단하게 진행할 수 있고, Zeppelin의 공유 기능을 이용하면 팀원 간에 협업도 가능할 것 같고 좋네요. 개인적으로는 Quicksight 처럼 애매한 BI 툴을 쓰는 것보다는 무료인 Zeppelin을 쓰는 것도 전문적인 BI를 요구하는게 아니라면 괜찮을 것 같습니다. </p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-03-20T15:00:00.000Z">2019-03-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/AWS-Lightsail/">AWS Lightsail</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 minutes read (About 1611 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/03/21/2019-03-21-lightsail-vs-ec2/">AWS Lightsail VS EC2</a>
            
        </h1>
        <div class="content">
            <p><img src="/images/lightsail.jpeg" alt="그림0"></p>
<h1 id="Lightsail-VS-EC2"><a href="#Lightsail-VS-EC2" class="headerlink" title="Lightsail VS EC2"></a>Lightsail VS EC2</h1><h2 id="Amazon-Lightsail"><a href="#Amazon-Lightsail" class="headerlink" title="Amazon Lightsail?"></a>Amazon Lightsail?</h2><p>Lightsail 이라는 서비스가 나온지는 좀 되었다. 간단하게 소개하면 <strong>아마존에서 제공하는 웹 호스팅 서비스</strong> 이다. 기본적인 컨셉 자체는 AWS라는 복잡하고 어려운 클라우드 어쩌구를 몰라도 웹호스팅을 다른 업체만큼 싸게 제공해주는 데 목적이 있는 듯하다. 영세한 웹호스팅업계에 AWS라는 공룡이 침입한 게 아닌가 싶다. Digital Oceans 같은 호스팅업체와 제공하는 서비스와 심지어 UI까지 비슷하다. Digital Oceans는 점점 클라우드 업체처럼 되어가고 있고 아마존은 호스팅 업계의 영역까지 군침을 흘리고 있는 모양새다. </p>
<p>어쨌든 Lightsail은 그저 ‘아마존의 웹호스팅 서비스’라는 것이 중요하다. </p>
<p>그런데, AWS를 사용하고 있는 사람 입장에서는 그럼 AWS에서 EC2를 사용하는것과 Lightsail에서 사용하는 것과 뭐가 다른지가 궁금하다. 간단하게 그 차이점을 정리해보려고 한다. </p>
<h2 id="Lightsail-VS-EC2-1"><a href="#Lightsail-VS-EC2-1" class="headerlink" title="Lightsail VS EC2"></a>Lightsail VS EC2</h2><p>어차피 요금과 기능이 제일 중요하다. 두 가지만 살펴보자. </p>
<ul>
<li>요금 </li>
<li>기능 </li>
</ul>
<h3 id="요금"><a href="#요금" class="headerlink" title="요금"></a>요금</h3><p>왠만한 조건에서는 Lightsail이 더 싸다. </p>
<p>Lightsail은 2GB 메모리, 즉 T2.small 기준으로 $10의 요금을 받는다. 여기에는 60GB의 SSD EBS 볼륨도 포함되어 있고 심지어, 트래픽 요금까지 포함되어있다. </p>
<p>EC2에서 t2.small을 3년 약정으로 잡고 (no-upfront), 60gb EBS를 잡으면 $12.62 가 나온다. 물론 여기에 트래픽비용은 별도다. </p>
<p>그러니 <strong>한달 내내 사용할거면 무조건 Lightsail이 싸다.</strong> (한달 내내 사용하는거니 스팟은 고려하지 않는다.)</p>
<p>그러나, 한달 내내 사용하는게 아니라면? </p>
<p>그럼 얘기가 달라진다. 일단, Lightsail은 월별 과금이다. 즉, 한번키면 ec2 처럼 stop-start가 안된다. ec2에서 자랑하는 초당 과금 뭐 그런거 없다. 그냥 월에 $10씩 꼬박꼬박 내면된다. 즉, ec2를 딱 필요한 시간에만 쓴다면 ec2가 훨씬 적게 나올 가능성이 있다는 말이다. 관리를 잘해주면 ec2는 사용한 만큼만 과금이 되니 굉장히 적은 비용으로 운용이 가능하다. </p>
<p><del>그러나 매번 껐다 키기는 귀찮다. 이거 잘 지키는 팀 잘 못봤다. (스크립트로 짜놓지 않는이상. )</del> </p>
<h3 id="기능"><a href="#기능" class="headerlink" title="기능"></a>기능</h3><p>먼저 EC2에선 되지만 Lightsail에서 안되는 기능들은 대략 다음과 같다. </p>
<ul>
<li>vpc관련 기능이 제한적</li>
<li>인스턴스 타입 변경 </li>
<li>정기적인 스냅샷 생성 </li>
<li>디테일한 보안그룹설정 </li>
<li>IAM role 부여</li>
<li>여러 로드밸런서 옵션 (예: NLB)</li>
</ul>
<p>등 뭔가 디테일하고 딥한 옵션은 제공하지 않는다. 대신 일반적인 웹호스팅에서 제공하는 기능들은 대부분 제공한다. </p>
<p>또한 Lightsail에서 특별히 제공해주는 기능도 있다. </p>
<ul>
<li>웹 SSH 콘솔</li>
<li>VPC Peering </li>
</ul>
<p>웹 콘솔은 디지털 오션같은데에서 기본으로 제공해주는 서비스라 AWS에서도 그냥 제공해주는 것 같다. EC2에서 비슷한 기능을 이용하려면 꽤나 복잡한 과정을 거쳐야한다.</p>
<p>거기에 내 생각에 매력인 옵션은 바로 ‘VPC peering’ 기능이다. Lightsail에서 인스턴스를 생성하면 그게 어떤 VPC에 생기는지 알수 없다. 그렇지만, Lightsail에서는 내 VPC와 Peering할수 있는 기능을 제공한다. 이 기능 덕분에 Lightsail의 활용성이 엄청 높아지는 것 같다. </p>
<h2 id="사설-및-정리"><a href="#사설-및-정리" class="headerlink" title="사설 및 정리"></a>사설 및 정리</h2><p>사실 이번에 개인적으로 Jira를 사용하려고 작은 EC2를 하나 띄워놨다. 근데 이게 아무리 생각해도 비용적으로 비효율적인게 t2.medium을 띄워놨는데 이게 한달에 거의 4만원 돈이다. 이럴 거면 그냥 jira cloud를 이용하는게 낫다. 이것보다 더 저렴한 옵션은 없나 찾아보던 중에 Lightsail을 발견했다. 구축한 Jira를 옮기는게 귀찮아서 지금 당장 Lightsail을 쓰진 않겠지만 다른 프로젝트를 할때는 충분히 고려할 만한 옵션인 듯 하다. </p>
<p>단독으로 웹서버를 띄우는 등의 간단하고 작은 규모의 서비스에게 Lightsail은 굉장히 매력적인 옵션으로 보인다. 가격이 거의 절반 가격이고, 매달 일정한 금액이 나오기 때문에 비용관리 측면에서도 유리하다. 트래픽도 기본 1TB씩 제공하기 때문에 크게 부족할 일이 없을 것 같다. DB 등 중요한 인프라는 기존 AWS 서비스를 사용해서 관리하고 이에 대한 연결은 Lightsail과 VPC Peering을 이용해서 가능하다. 뭔가 엄청난 트래픽이 예상되는 서비스만 아니면 왠만한 서비스에서 모두 고려할 만 하다. </p>
<p>물론 안정적인 서비스를 원하는 팀에게는 추천하기 애매하다. 일단 SLA를 제공하지 않고, t2타입의 특성상 장애가 발생할 가능성이 있다. 또한 VPC 관리 등이 되지 않기 때문에 뭔가 불투명하고 막연하다. 웹호스팅에 익숙한 업체들이야 상관 없겠지만, 아닌 경우 뭔가 보안에 취약해보이고, 허접한 서비스 같아보인다. $10~$20 가 중요하지 않은 업체는 그냥, m5.large를 multi-az 구성해서 튼튼하게 가는게 여러가지로 낫다. </p>
<p>즉, 만원 이만원이 중요하고, 매달 일정한(그리고 아주 작은) 요금이 나오길 바라는 팀, 예를들어 스타트업은 Lightsail을 적극 고려하시길. 또한 개인 웹사이트 등을 고려하는데 뭔가 AWS를 사용해보고 싶다면, 사용해볼만하다. 다른 호스팅업체보다는 약간 비싸지만 무지막지하게 비싼 가격은 아니라고 생각하고, 다른 클라우드에 비하면 싸다. </p>
<p>끝.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-09-27T15:00:00.000Z">2018-09-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/AWS-RDS-mysql/">AWS RDS mysql</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 778 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/09/28/2018-09-28-cross-region-read-replica-version-issue/">AWS RDS mysql - 다른 리전에 읽기복제본 생성: 버전이슈</a>
            
        </h1>
        <div class="content">
            <p><img src="/images/readreplica.png" alt="그림0"></p>
<h3 id="읽기-복제본-생성"><a href="#읽기-복제본-생성" class="headerlink" title="읽기 복제본 생성"></a>읽기 복제본 생성</h3><p>다른 리전에 읽기복제본을 생성해야 될 때가 있다. 대충 추려보면 다음과 같은 경우. </p>
<ol>
<li>다른 리전에 데이터를 읽기만 하는 워크로드가 있는 경우 </li>
<li>다른 리전에 DR 용으로 데이터를 보관하는 경우</li>
</ol>
<p>그럴때 RDS의 읽기복제본 생성 기능은 매우 간편하고 효과적이다. 파라미터 그룹을 만진다든지 하는 설정을 해줄 필요 없이 대상 리전에 서브넷 그룹만 잘 설정 되어 있으면 콘솔에서 클릭 몇번으로 복제본을 생성할 수 있다. </p>
<p><strong>초간단 읽기복제본 생성 가이드</strong></p>
<ol>
<li>생성할 지역 RDS에서 DB subnetgroup 생성</li>
<li>원본 DB에서 Create read replica 클릭 후 설정. </li>
</ol>
<p>이렇게 해서 읽기 복제본은 한 인스턴스당 5개 까지 만들 수 있다. 그리고 만든 읽기 복제본을 multi-az 구성해 가용성을 높일수도 있다. 꽤 괜찮은 기능인듯? </p>
<h3 id="그런데-이게-잘-안될-수도-있다"><a href="#그런데-이게-잘-안될-수도-있다" class="headerlink" title="그런데, 이게 잘 안될 수도 있다"></a>그런데, 이게 잘 안될 수도 있다</h3><p>테스트를 해봤다. 현재(2018년 9월 28일)기준 서울리전에서 mysql 5.7의 최신 버전은 5.7.23이다. 이 버전으로 mysql을 생성하고 도쿄리전에 read replica를 생성해 보겠다. </p>
<p><img src="/images/rds-replica-error.png" alt="그림1"><br>안된다…! </p>
<p>그럼 다른 리전에는 될까? 싱가폴엔 된다. 버지니아 리전엔 안 된다. (다른 리전엔 거의 되는 듯 했다.) 뭐지 이게…? 도쿄리전과 버지니아 리전에 장애가 있나?</p>
<h3 id="대체-왜그럴까"><a href="#대체-왜그럴까" class="headerlink" title="대체 왜그럴까?"></a>대체 왜그럴까?</h3><p>일단 에러를 추적해 보자. 에러는 다음과 같다.</p>
<p><em>Cannot find version 5.7.23 for mysql (Service: AmazonRDS; Status Code: 400; Error Code: InvalidParameterCombination; Request ID: ed9ba771-ee3e-4334-b868-e3b3082a4286)</em></p>
<p>그니깐 5.7.23 버전을 못찾겠다는 말이다. </p>
<p>대체 무슨 문제일까 찾아보니, <em>도쿄리전, 버지니아 리전 등에는 mysql 5.7.23이 없다.</em> 마찬가지로 mysql 5.6.41버전도 tokyo 리전엔 없어서 읽기 복제본 생성이 불가능 하다. 즉, 읽기 복제본을 만드려고 하는 mysql 버전이 해당 리전에 존재하지 않기 때문에 복제본을 생성할 수 가 없는 것이다.  </p>
<p>아니 대체 왜? 보통 도쿄, 버지니아는 업데이트가 가장 빠른 지역이 아닌가. 그나마 의심해 볼수 있는건 최신버전을 RDS에 적용하는데 문제가 있다거나… 홀수 버전은 취급 안한다든가… 등을 의심해볼 수 있겠지만 무슨 이슈가 있는지 정확하게 파악기는 어렵다. 그냥 지금 상태로는 안되는 것이다. 따라서 마이너 버전 업데이트를 롤백하든지… 도쿄리전 등에 마이너 버전이 업데이트 되길 기다리든지 해야 한다.</p>
<p>여튼 RDS에서 다른리전에 읽기복제본 생성시 주의사항 하나가 추가되었다.</p>
<h3 id="대상-리전에-해당-mysql-버전이-있는지-확인할-것"><a href="#대상-리전에-해당-mysql-버전이-있는지-확인할-것" class="headerlink" title="대상 리전에 해당 mysql 버전이 있는지 확인할 것"></a>대상 리전에 해당 mysql 버전이 있는지 확인할 것</h3>
        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-09-17T15:00:00.000Z">2018-09-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/reviewrepublic-migragtion/">reviewrepublic migragtion</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 minutes read (About 1692 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/09/18/2018-09-18-reviewrepublic-log-2/">reviewrepublic 심폐소생술 - (2)DigitalOcean -&gt; AWS</a>
            
        </h1>
        <div class="content">
            <p>이번 편에선 DigitalOcean 에서 AWS로 서버들을 옮기는 과정을 적어본다. </p>
<p>전에도 말했지만 리뷰리퍼블릭의 어플리케이션은 meteor.js 라는 프레임워크 (조금 더 정확하게는 meteor.js + react.js) 위에서 돌아간다. 이 프레임워크 덕분에 마이그레이션이 두배는 더 어려워졌다. 일단 익숙한 방식 (어디 한 express.js 나 스프링 MVC 정도 사용할 줄 알았는데…)이 아니기에 이 프레임워크의 전체적인 개념부터 어떤식으로 배포가 되는지를 파악해야 했다. </p>
<ol>
<li>서버 배포방식 확인, 배포</li>
</ol>
<p>그렇다고 지금 이 포스팅에서 meteor.js의 작동방식에 대해 다룰 것은 아니다. 왜냐하면 다행히 리뷰리퍼블릭의 프라이빗 코드저장소에는 간략한(무려 네줄) 서버 실행 및 배포 방법이 적혀있었기 때문이다. (이렇게 문서화가 중요하다.)</p>
<p>서버 실행은 meteor.js 에 setting.js 파일을 참조해서 하면 되고 배포는 mup.js 라는 배포툴을 이용하고 있었다. 그러니 나는 이걸 aws 인프라 위에서 작동이 되는지 확인만 하면 됐다. </p>
<p>먼저 로컬환경에서 테스트를 해봤다. 내 로컬 컴퓨터에서 정상적으로 어플리케이션이 돌아가는지, 돌아가는 어플리케이션은 실 서비스의 동작과 같은지 확인해야했다. 다행히 하라는 대로 하니 서버가 돌아가긴 했다. 다만 환경변수 세팅이 제대로 안되어있어서 db 접속이 안됐다. 환경변수만 조금 세팅해주니 정상적으로 어플리케이션이 돌아갔다. 또 다행히도 실서비스와 같은 동작을 하는 서버 같았다. (아쉽게도 테스트코드 같은것은 없었다.)</p>
<p>AWS에서 올려보려고 했다. 로컬에서와 똑같은 방식으로 실행을 시키려고 하는데 알수없는 이유로 자꾸 meteor가 빌드 중에 죽었다. 정확한 이유를 파악하기 어려웠다. 결국 mup.js를 통해서 다시 시도했다. mup.js 는 해당 meteor 어플리케이션의 도커 이미지를 만들고 그 도커이미지를 통해 원격 서버에서 컨테이너로 실행시켜주는 배포 툴인듯 했다. 몇번의 시도 끝에 EC2 인스턴스 위에 배포하는 데에 성공했다. mup.js에서 미리 세팅해놓은 덕에 환경변수도 깔끔하게 들어가서 db 접속문제도 없었다. 잘 돌아가기에 해당 서버의 AMI를 생성해서 이미지를 저장해놨다. </p>
<p>이렇게 서버 배포는 간단하게 끝이났다. 결국 서버 이전의 방식은 뭐 서버의 이미지를 떠서 새로운 서버를 올리는 방식이 아니라, 그냥 새로운 서버 하나를 생성하고 그 위에 소스코드를 배포하는 방식이 되었다. 그러니깐, Digital Ocean이랑은 아무 상관이 없었다. 그냥 리눅스 가상머신 위에 소스를 배포하기만 하면 되는 일이었다. 다행히 코드저장 및 최소한의 인스트럭션이 남아있었고 이를 토대로 재배포를 정상적으로 수행할 수 있었다. 와… 만약에 그런 최소한의 코드 정리도 안되어 있고 문서화가 안되어있는 상황이었으면… 아마 그냥 포기하지 않았을까. </p>
<ol start="2">
<li>로드밸런서 변경, 오토스케일링 적용. </li>
</ol>
<p>일단 기존 로드밸런서에 가용성 문제가 있었다. 기존에는 그냥 인스턴스를 하나 띄워서 그 인스턴스가 로드밸런서의 역할을 한다. 그러다 만약 해당 인스턴스가 뻗어버리면? 바로 서비스 장애로 이어진다. 그러니 인스턴스가 뻗지 않게 사양도 높게 잡아줘야 하고 인스턴스의 가용성 관리도 해야하는건데 그게 쉽지 않다. AWS의 로드밸런서 서비스인 ELB는 고맙게도 그런걸 다 해준다(정확히는 AWS가 보장…해준다고 한다.). ELB 로드밸런서가 뻗지 않게 가용성을 보장해주는 관리형 서비스로 트래픽이 몰려도 이에 맞게 로드밸런서가 대응한다. 아무래도 무식하게 좋은서버 한대 올려서 로드밸런서 구성하는것 보다는 구성도 간단하고 요금도 무작정 성능 좋은 서버 하나에 로드밸런서 올려놓는 것보다 저렴하다. </p>
<p>그래서 로드밸런서를 ELB로 교체했다. </p>
<p>그리고 오토스케일링 적용. 트래픽이 늘어났을때 LB만 살아있다고 되는게 아니라 결정적으로 앱 서버가 살아있어야 한다. 은행에서 티켓 발행하는 기계가 아무리 살아있어도 은행원들이 탈진해버리면 은행 서비스가 불가능한 것과 똑같다. 그러니 앱 서버에도 가용성관리가 들어가야 한다. digital ocean은 아쉽게도 이러한 오토스케일링을 적용하려면 haproxy 등을 통해 직접 구성해야한다. AWS는 이 autoscaling 구성이 간편한게 자랑이다. </p>
<p>그래서 autoscaling을 구성했다. 이렇게 함으로써 얻는 이점은 일단은 가용성이다. autoscaling을 통해 인스턴스가 알수없는 이유로 죽더라도 다시 생성된다. 또한 로드밸런서의 가용성도 올라갔다. 구성은 그냥 아까 서버 배포하면서 생성한 ami를 기준으로 시작구성 생성하고 오토스케일링 적용시켜주면 끝. </p>
<ol start="3">
<li>보너스… 싱가폴 -&gt; 서울 </li>
</ol>
<p>다른 얘길 적다보니 얘기 안했는데 digitalocean에서 제일 가까운 서버가 싱가폴에 있다. AWS는 서울리전이 지원된다. 응답속도는 적게는 0.2초, 많게는 거의 0.7초정도 차이난다(물론 테스트 환경마다 다름). 그러니 싱가폴에서 서울로 옮기기만 해도 최소 0.2초 정도는 버는 셈이었다. 근데 그럼 뭐해 사이트 로딩하는데 7~8초 걸리는데… 0.2초 차이 티도 안남.</p>
<p>이 글을 적던 도중 리뷰리퍼블릭이 터져버렸다… </p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-09-10T15:00:00.000Z">2018-09-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/reviewrepublic-migragtion/">reviewrepublic migragtion</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 minutes read (About 1934 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/09/11/2018-09-11-reviewrepublic-log-1/">reviewrepublic 심폐소생술 - (1)프로젝트 수락</a>
            
        </h1>
        <div class="content">
            <h2 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h2><p>페이스북에 <em>리뷰왕 김리뷰</em>라는 페이지가 있다. 갖가지 리뷰들이 올라오고 요새 올라오는 카드뉴스식의 리뷰를 선도한(…?) 페이지이다. 그 김리뷰가 <em>리뷰리퍼블릭</em>이라는 서비스를 만들었다. 사용자들이 리뷰를 작성해서 올리고 양질의 리뷰를 올릴수록 그 보상이 작성자에게 돌아가게끔 하겠다는 취지로 만들었다고 한다. 어쨋든 겉으로 보이는 형태는 조그만한 커뮤니티 앱이다. 어떻게 보면 sns같기도 하고. 어쨋든 그런 조그마한 커뮤니티 앱이 월 100만원 가량의 유지비가 나온다는 소식을 들었다. 서비스 유지비용이 월 100만원씩 나온다면 도저히 수지타산이 안나온다. 곧 망할 것 같았다. </p>
<p>곧 망했다. 그래도 서비스는 사비로 유지되고 있었다. 그래서 비용을 줄이는 데에 도움이 되고 싶었다. 마침 클라우드 서비스를 공부하고 있기도 했고 공부하다가 실질적인 서비스를 운용해봐야 좀 더 실질적인 공부가 될 것 같기도 해서 덜컥 김리뷰계정에 메세지를 보냈다. “아무리 봐도 100만원은 오바다. 회사가 망하기도 했고 여러가지로 힘든상황인것 같지만 리뷰리퍼블릭의 취지 자체는 좋은것 같다. 나에게도 한 사이트의 비용구조 개선은 공부가 된다. 도와주겠다.” 라고 연락을 했다. 그러나 첫번째에는 답이 없었다. 다시 연락했고, 답이 왔다. 만나서 자세히 얘기해보기로 했다. </p>
<p>만나서 계정정보들을 받고 살펴보니 왜 100만원이라는 돈이 나오는지는 알 것 같았다. 일단 이미지 서버비용(imgix)이 너무 많이 들고, 안쓰는 리소스들이 너무 많았다. 개발서버, 스테이징 서버들을 클라우드에 올려놓았지만… 개발자가 없는걸? 놀고 있는 서버들이 많았다. 일단 놀고있는 서버들만 정리하면 비용은 좀 줄일 수 있을 것 같았다. 그래서 흔쾌히 작업을 수락했고 금방 끝낼 수 있을것 같았다. </p>
<p>착각이었다. 생각보다 복잡한 구조를 가진 어플리케이션이었고 많이 쓰이지 않는 프레임워크(meteor.js)로 제작되어있었다. 해당 프레임워크를 공부해야했고, 리소스들은 정리가 안되어 있었다. 오버스펙으로 인프라가 구성된 이유가 있었다. 어플리케이션 자체가 비효율적으로 제작되어 있었다. 그러니깐 애초의 생각처럼 <strong>인프라 구성만 바꾼다고 되는게 아니라 어플리케이션 자체를 수정</strong>해야 비용구조를 개선하고 퍼포먼스도 올릴 수 있는 프로젝트였던 것이다. 결국엔 소스코드까지 뒤져봐야했다. </p>
<hr>
<h2 id="누구나-처음엔-그럴듯한-계획을-갖고있다"><a href="#누구나-처음엔-그럴듯한-계획을-갖고있다" class="headerlink" title="누구나 처음엔 그럴듯한 계획을 갖고있다."></a>누구나 처음엔 그럴듯한 계획을 갖고있다.</h2><p><strong>일단 인프라부터 옮기자</strong></p>
<p>그래도 하는 수 없이 일단 인프라 레벨에서부터 접근했다. 메인 어플리케이션이 돌고 있는 서버는 digital ocean이라는 클라우드 서비스를 통해서 운영되고 있었다. 디지털오션의 서비스 자체에는 큰 문제가 없었다. 어차피 복잡한 구조의 어플리케이션이 아니라 단순한 웹어플리케이션이기 때문에 어떤 서버를 이용하든지 큰 상관은 없다. 다만 문제는 서비스 규모에 비해서 지나치게 많은 리소스들이 사용되고 있었다. 아래 그림에서 보이겠지만 실제 서비스에 이용되는것은 로드밸런서 노릇을 하는 서버 한대와 그 밑에 웹서버가 동작하고있는 서버 4대, 즉 5대가 전부였지만, 배치서버, 검색서버, 스테이징 서버, 젠킨스 서버, 개발 서버 등 합쳐서 16개의 서버가 돌아가고 있었다. 돈이 많다면야 이렇게 해놓는게 관리나 개발차원에서 편하겠지만 이미 망해버린 상황에서는 많이 오바였다. 그래서 하나하나 서버들, 서버위에 올라간 코드들을 훑어보면서 실제 서비스와 연관이 없는 서버들은 일단 모두 정지시켰다.</p>
<p>또 다른 문제점은 DB 서버였다. 리뷰리퍼블릭은 몽고DB를 사용하고 있는데 Mlab에서 제공하는 SaaS 형태의 서비스를 이용하고 있었다. 일단은 이 서비스가 매우 <em>창렬하다</em>는게 문제였다. 한달에 $180나 되는 비용을 지불하는데 거기에 돌아가는 인스턴스는 매우 낮은 스펙이었다. 또한 이 서비스를 이용하면 DB서버는 AWS 위에 올라가게 되는데 그렇게 되면 Digital Ocean &lt;-&gt; AWS 간의 구간에서 퍼블릭 인터넷망을 이용해야 했다. 보안상으로도, 네트워크적인 측면에서도 마이너스이다. </p>
<p>결국 DB서버도 마이그레이션을 해야했고 그러던 와중 mongodb에서 직접 운영하는 SaaS형태의 서비스인 Atlas를 검토하게 되었다. 제공하는 기능도 Atlas가 더 많았고 결정적으로 같은 가격에 제공되는 인스턴스의 스펙이 Atlas가 훨씬 좋았다. 게다가 $100 무료쿠폰도 얻었다. 사실 MongoDB를 그냥 AWS 서버 위에 올려서 운영하는 것도 검토해봤지만 Atlas에서 제공하는 on-line 마이그레이션, 성능 모니터링, 자동 fail-over 등의 기능이 마음에 들었다. 내가 직접 관리하게 되면 저런것들을 다 수동으로 작업해야되는데 기본으로 제공해주니 엄청난 메리트였다. </p>
<p>DB 서버를 마이그레이션 하기로 결정을 하고 나니 다시 어플리케이션서버가 Digital Ocean에 올라가있는 게 걸렸다. 사실 애초에 AWS로 옮길 생각이었다. 내가 편한 환경이기도 하고 Digital Ocean이 서울에 서버가 없기도 하고, 여타 기능에선 AWS가 압도적이기 때문. 또한 DB가 AWS에 올라가기 때문에 어플리케이션 서버도 AWS에 올라가있는 게 성능면에서나 안정성면에서나 훨씬 낫다. DB 서버가 위치하는 네트워크(VPC)와 어플리케이션 서버가 위치하는 네트워크 사이에 VPC Peering을 맺으면 AWS의 내부망을 이용할 수 있다.</p>
<p>그래서 일단 기본적인 마이그레이션의 가닥은 다음과 같았다.  </p>
<ol>
<li>어플리케이션: Digital Ocean -&gt; AWS</li>
<li>DB: Mlab -&gt; Atlas</li>
</ol>
<p>이러면 일단 인프라적으로는 비효율적인 부분을 많이 개선하는 것이라고 생각했다. <strong>(그럴리가…)</strong></p>
<p>다음 포스팅에서는 Digital Ocean -&gt; AWS 로 옮기는 작업때 있었던 일들에 대해서 다뤄보겠다. </p>
<h3 id="리뷰리퍼블릭의-기존-아키텍쳐"><a href="#리뷰리퍼블릭의-기존-아키텍쳐" class="headerlink" title="리뷰리퍼블릭의 기존 아키텍쳐"></a><strong>리뷰리퍼블릭의 기존 아키텍쳐</strong></h3><p><img src="/images/reviewrepublic-legacy.png" alt="그림1"></p>
<p><br><br></p>
<h3 id="리뷰리퍼블릭-변경-아키텍쳐"><a href="#리뷰리퍼블릭-변경-아키텍쳐" class="headerlink" title="리뷰리퍼블릭 변경 아키텍쳐"></a><strong>리뷰리퍼블릭 변경 아키텍쳐</strong></h3><p><img src="/images/reviewrepublic-tobe.png" alt="그림2"></p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/3/">3</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="Your name">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Your name
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Your title
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Your location</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            22
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            19
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            0
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                Follow</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/ppoffice">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/AWS-Athena-Cloudfront/">
            <span class="level-start">
                <span class="level-item">AWS Athena Cloudfront</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-Athena-Zeppelin/">
            <span class="level-start">
                <span class="level-item">AWS Athena Zeppelin</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-EC2-T3/">
            <span class="level-start">
                <span class="level-item">AWS EC2 T3</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-EC2-Windows/">
            <span class="level-start">
                <span class="level-item">AWS EC2 Windows</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-Elasticsearch/">
            <span class="level-start">
                <span class="level-item">AWS Elasticsearch</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-Lambda-SQS/">
            <span class="level-start">
                <span class="level-item">AWS Lambda SQS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-Lightsail/">
            <span class="level-start">
                <span class="level-item">AWS Lightsail</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-RDS/">
            <span class="level-start">
                <span class="level-item">AWS RDS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-RDS-mysql/">
            <span class="level-start">
                <span class="level-item">AWS RDS mysql</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/AWS-SAML/">
            <span class="level-start">
                <span class="level-item">AWS SAML</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Bigdata-AWS-EMR/">
            <span class="level-start">
                <span class="level-item">Bigdata AWS EMR</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/activedirectory-dns-aws/">
            <span class="level-start">
                <span class="level-item">activedirectory dns aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/database-postgresql/">
            <span class="level-start">
                <span class="level-item">database postgresql</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/docker-network-multihost/">
            <span class="level-start">
                <span class="level-item">docker network multihost</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/jekyll-github/">
            <span class="level-start">
                <span class="level-item">jekyll github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/jekyll-theme-swiss/">
            <span class="level-start">
                <span class="level-item">jekyll theme swiss</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python-bigdata/">
            <span class="level-start">
                <span class="level-item">python bigdata</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/reviewrepublic-migragtion/">
            <span class="level-start">
                <span class="level-item">reviewrepublic migragtion</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/12/04/hello-world/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Hello World">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-04T00:59:11.881Z">2019-12-04</time></div>
                    <a href="/2019/12/04/hello-world/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Hello World</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/04/2019-11-04-lambda-with-sqs/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Lambda의 동시성에 대하여 - 1">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-03T15:00:00.000Z">2019-11-04</time></div>
                    <a href="/2019/11/04/2019-11-04-lambda-with-sqs/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Lambda의 동시성에 대하여 - 1</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/AWS-Lambda-SQS/">AWS Lambda SQS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/29/2019-06-29-EMR-Athena-Zepplin/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="EMR 에 올라간 Zeppelin 활용하여 Athena 이용하기. ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-28T15:00:00.000Z">2019-06-29</time></div>
                    <a href="/2019/06/29/2019-06-29-EMR-Athena-Zepplin/" class="title has-link-black-ter is-size-6 has-text-weight-normal">EMR 에 올라간 Zeppelin 활용하여 Athena 이용하기. </a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Bigdata-AWS-EMR/">Bigdata AWS EMR</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/07/2019-06-20-amazon-elasticsearch-dedicated-master-free-storage/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Amazon Elasticsearch Dedicated Master의 스토리지 비용은?">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-06T15:00:00.000Z">2019-06-07</time></div>
                    <a href="/2019/06/07/2019-06-20-amazon-elasticsearch-dedicated-master-free-storage/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Amazon Elasticsearch Dedicated Master의 스토리지 비용은?</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/AWS-Elasticsearch/">AWS Elasticsearch</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/07/2019-06-07-athena-cf-log-analysis/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="AWS Athena, CF Log 분석을 위한 쿼리 예시">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-06T15:00:00.000Z">2019-06-07</time></div>
                    <a href="/2019/06/07/2019-06-07-athena-cf-log-analysis/" class="title has-link-black-ter is-size-6 has-text-weight-normal">AWS Athena, CF Log 분석을 위한 쿼리 예시</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/AWS-Athena-Cloudfront/">AWS Athena Cloudfront</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/12/04/hello-world/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Hello World">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-04T00:59:11.881Z">2019-12-04</time></div>
                    <a href="/2019/12/04/hello-world/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Hello World</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/04/2019-11-04-lambda-with-sqs/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Lambda의 동시성에 대하여 - 1">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-03T15:00:00.000Z">2019-11-04</time></div>
                    <a href="/2019/11/04/2019-11-04-lambda-with-sqs/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Lambda의 동시성에 대하여 - 1</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/AWS-Lambda-SQS/">AWS Lambda SQS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/29/2019-06-29-EMR-Athena-Zepplin/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="EMR 에 올라간 Zeppelin 활용하여 Athena 이용하기. ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-28T15:00:00.000Z">2019-06-29</time></div>
                    <a href="/2019/06/29/2019-06-29-EMR-Athena-Zepplin/" class="title has-link-black-ter is-size-6 has-text-weight-normal">EMR 에 올라간 Zeppelin 활용하여 Athena 이용하기. </a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Bigdata-AWS-EMR/">Bigdata AWS EMR</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/07/2019-06-20-amazon-elasticsearch-dedicated-master-free-storage/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Amazon Elasticsearch Dedicated Master의 스토리지 비용은?">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-06T15:00:00.000Z">2019-06-07</time></div>
                    <a href="/2019/06/07/2019-06-20-amazon-elasticsearch-dedicated-master-free-storage/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Amazon Elasticsearch Dedicated Master의 스토리지 비용은?</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/AWS-Elasticsearch/">AWS Elasticsearch</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/06/07/2019-06-07-athena-cf-log-analysis/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="AWS Athena, CF Log 분석을 위한 쿼리 예시">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-06-06T15:00:00.000Z">2019-06-07</time></div>
                    <a href="/2019/06/07/2019-06-07-athena-cf-log-analysis/" class="title has-link-black-ter is-size-6 has-text-weight-normal">AWS Athena, CF Log 분석을 위한 쿼리 예시</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/AWS-Athena-Cloudfront/">AWS Athena Cloudfront</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Boomkim" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 boomkim&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
<script src="/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="Back to Top" href="javascript:;" target="_blank" rel="noopener">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>